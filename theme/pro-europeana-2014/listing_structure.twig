{#
	structures list template
#}


{# get contenttype object #}
{% set contenttype = structurecontenttype(record.slug) %}
{% if contenttype == 0 %}
	{% set contenttype = getContenttype(record.content) %}
{% endif %}

{% if contenttype != 0 %}
	
	{# set order #}
	{% set order = contenttype['sort'] %}
	{% if app.request.get('order') %}
		{% set order = app.request.get('order') %}
	{% endif %}
	{# set page number #}
	{% set page = app.request.get('page', 1) %}
	{# set amount #}
	{% if contenttype['listing_records'] is defined %}
		{% set amount = contenttype['listing_records'] %}
	{% else %}
		{% set amount = app.config.get('general/listing_records') %}
	{% endif %}
	
{% endif %}
	

{# listing for stucture with fixed content  #}
{% if (record.content != '' and record.content != 'default' )  %}
	{% setcontent records = record.content where { limit : amount, order : order, page : page }  %}

{# listing for structure with mixed content #}
{% elseif contenttype %}

	{% set recordsStruture = [] %}
	{% if order in record.contenttype['fields']|keys %}
		{% setcontent recordsStruture = 'Structures' where { tree : record.slug, limit: 10000, order : order }  %}
	{% endif %}
	{% setcontent records = contenttype['name'] where { tree : record.slug, order : order}  %}
	
	{% set records = records|merge(recordsStruture)|order(order) %}
	{% set pager = { totalpages :  (records|length/amount)|number_format+1,  current : page }  %}
	{% set records = records|slice(amount*(page-1),amount) %}
	
{# listing for structure content #}
{% else %}
	{% setcontent records = 'Structures' where { tree : record.slug } %}
{% endif %}


{% if records is defined %}
	{% if (records|length and records|first.contenttype.name == 'Persons') %}
		{% set records = records|order('team') %}
		{% include 'listing_person.twig' with {records: records } %}
	{% else %}
		{% include 'listing.twig' with {records: records} %}
	{% endif %}
{% endif %}
	
